<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Controle Presencial</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  </head>

  <body>
    <!-- Fundo -->
    <div class="bg"></div>

    <main class="wrap">
      <section class="card">
        <!-- Cabe√ßalho -->
        <header class="header">
          <h1>Controle Presencial</h1>
          <p class="subtitle">Registro de Entrada e Sa√≠da</p>
        </header>

        <!-- Mensagens do backend -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="alerts">
              {% for category, message in messages %}
                <div class="alert {{ category }}">{{ message }}</div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <!-- Formul√°rio -->
        <form method="POST" action="{{ url_for('registrar') }}" class="form">
          <!-- CPF -->
          <label class="label" for="cpf">CPF (somente n√∫meros)</label>
          <input
            class="input"
            id="cpf"
            name="cpf"
            type="text"
            inputmode="numeric"
            pattern="[0-9]{11}"
            maxlength="11"
            minlength="11"
            placeholder="Digite o CPF (11 d√≠gitos)"
            autocomplete="off"
            required
            oninput="this.value = this.value.replace(/\D/g,'').slice(0,11)"
          />

          <!-- PIN -->
          <label class="label" for="pin">PIN</label>
          <input
            class="input"
            id="pin"
            name="pin"
            type="password"
            inputmode="numeric"
            maxlength="6"
            placeholder="Digite seu PIN"
            autocomplete="off"
            required
            oninput="this.value = this.value.replace(/\D/g,'').slice(0,6)"
          />

          <!-- A√ß√µes -->
          <div class="actions">
            <button class="btn btn-primary" type="submit" name="action" value="entrada">
              ‚úÖ Entrada
            </button>
            <button class="btn btn-danger" type="submit" name="action" value="saida">
              üö™ Sa√≠da
            </button>
          </div>

          <p class="hint">
            Informe o CPF e o PIN cadastrados e selecione a a√ß√£o desejada.
          </p>

          <!-- (Opcional) Link para admin -->
          <p class="hint" style="margin-top:10px">
            <a href="/admin" style="color: var(--muted); text-decoration: underline;">
              Acessar painel (/admin)
            </a>
          </p>
        </form>
      </section>
    </main>

    <!-- Valida√ß√£o extra (mobile-friendly) -->
    <script>
      const form = document.querySelector("form.form");
      const cpf = document.getElementById("cpf");
      const pin = document.getElementById("pin");

      form.addEventListener("submit", (e) => {
        const cpfVal = (cpf.value || "").replace(/\D/g, "");
        const pinVal = (pin.value || "").replace(/\D/g, "");

        if (cpfVal.length !== 11) {
          e.preventDefault();
          alert("CPF inv√°lido. Digite exatamente 11 n√∫meros.");
          cpf.focus();
          return;
        }

        if (!pinVal) {
          e.preventDefault();
          alert("PIN inv√°lido. Digite o PIN cadastrado.");
          pin.focus();
          return;
        }
      });

      // foco autom√°tico no CPF
      cpf.focus();
    </script>
  </body>
</html>
